---
phase: 07-notifications-feature
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/features/NOTIFICATIONS.md
  - docs/README.md
autonomous: true

must_haves:
  truths:
    - "Developer can trace notification flow from trigger to display"
    - "Developer understands why each permission is required"
    - "Developer can debug notification issues using documented flow"
    - "Notification channels and their configuration are explained"
    - "Snooze and dismiss actions are documented"
  artifacts:
    - path: "docs/features/NOTIFICATIONS.md"
      provides: "Complete notification system documentation"
      min_lines: 400
      contains: ["ReminderTriggerWorker", "NotificationStarterService", "POST_NOTIFICATIONS", "SCHEDULE_EXACT_ALARM"]
    - path: "docs/README.md"
      provides: "Updated documentation status"
      contains: "Available"
  key_links:
    - from: "docs/features/NOTIFICATIONS.md"
      to: "docs/features/REMINDERS.md"
      via: "Related Documentation links"
      pattern: "REMINDERS\\.md"
    - from: "docs/features/NOTIFICATIONS.md"
      to: "docs/ARCHITECTURE.md"
      via: "Related Documentation links"
      pattern: "ARCHITECTURE\\.md"
---

<objective>
Create comprehensive notification system documentation for Notiva, covering the complete flow from reminder scheduling through ReminderTriggerWorker to notification display via NotificationStarterService.

Purpose: Enable developers to understand, debug, and modify the notification system without reverse-engineering the code.

Output: docs/features/NOTIFICATIONS.md with sequence diagrams, permission tables, and debugging guide.
</objective>

<execution_context>
@/Users/ansagagr/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ansagagr/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-reminders-feature/06-01-SUMMARY.md

# Source files for documentation
@app/src/main/java/com/ava/notiva/service/ReminderTriggerWorker.java
@app/src/main/java/com/ava/notiva/service/NotificationStarterService.java
@app/src/main/java/com/ava/notiva/service/NotificationStopperService.java
@app/src/main/java/com/ava/notiva/service/BootReceiver.java
@app/src/main/java/com/ava/notiva/util/ReminderWorkerUtils.java
@app/src/main/java/com/ava/notiva/util/ReminderConstants.java
@app/src/main/AndroidManifest.xml
@docs/features/REMINDERS.md
@docs/README.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Notifications Feature Documentation</name>
  <files>docs/features/NOTIFICATIONS.md, docs/README.md</files>
  <action>
Create docs/features/NOTIFICATIONS.md with the following structure (follow the pattern established in REMINDERS.md):

**1. Header and Related Documentation Links**
- Title: "Notifications Feature"
- Links to: Architecture Overview, Reminders Feature, Back to Documentation Hub

**2. Overview Section**
- Brief explanation: Notifications are the delivery mechanism for reminders
- Key capabilities table covering: Scheduling, Display, Sound/Vibration, Snooze, Dismiss, Reboot handling

**3. Key Components Table**
Document these components with their files and purposes:
- ReminderTriggerWorker (service/ReminderTriggerWorker.java) - WorkManager job that schedules alarms
- NotificationStarterService (service/NotificationStarterService.java) - Foreground service that displays notification
- NotificationStopperService (service/NotificationStopperService.java) - Handles snooze and dismiss actions
- BootReceiver (service/BootReceiver.java) - Reschedules reminders after device reboot
- ReminderWorkerUtils (util/ReminderWorkerUtils.java) - Utility for enqueueing worker
- ReminderConstants (util/ReminderConstants.java) - Channel ID and action constants

**4. Permissions Section**
Create a table documenting each permission from AndroidManifest.xml:
- POST_NOTIFICATIONS: Required to display notifications (API 33+, runtime permission)
- SCHEDULE_EXACT_ALARM: Required for exact alarm timing
- USE_EXACT_ALARM: Alternative permission for exact alarms (API 31+)
- FOREGROUND_SERVICE: Required for foreground service
- FOREGROUND_SERVICE_MEDIA_PLAYBACK: Required for alarm sound playback
- VIBRATE: Required for vibration feedback

Include a note about runtime permission handling for POST_NOTIFICATIONS.

**5. Notification Channel Section**
Document the notification channel configuration from ReminderConstants.java and NotificationStarterService.java:
- Channel ID: NOTIVA_CHANNEL
- Channel Name: com.ava.notiva
- Importance: HIGH
- Light color: BLUE
- Lock screen visibility: PRIVATE

**6. Notification Flow Diagram**
Create a Mermaid sequence diagram showing the complete flow:
1. Reminder created -> ReminderTriggerWorker scheduled
2. ReminderTriggerWorker runs -> Iterates reminders -> Schedules AlarmManager alarms
3. Alarm fires -> NotificationStarterService starts
4. NotificationStarterService -> Creates notification channel -> Builds notification -> startForeground
5. MediaPlayer starts (alarm sound) -> Vibrator starts

**7. Snooze/Dismiss Flow Diagram**
Create a Mermaid sequence diagram for user actions:
1. User taps Snooze action -> NotificationStopperService
2. NotificationStopperService stops NotificationStarterService
3. If snooze: Enqueues ReminderTriggerWorker to reschedule
4. User taps Dismiss action -> Same flow without reschedule

**8. Boot Handling Flow Diagram**
Create a Mermaid sequence diagram for reboot scenario:
1. Device boots -> BOOT_COMPLETED broadcast
2. BootReceiver receives -> Enqueues periodic ReminderTriggerWorker (1 minute interval)
3. WorkManager handles deduplication via enqueueUniquePeriodicWork

**9. Service Architecture Section**
Document why foreground service is used:
- Required for reliable notification display
- MediaPlayer needs active context
- Vibration needs active service
- Document foregroundServiceType="mediaPlayback" in manifest

**10. Notification Actions Section**
Document the notification action buttons:
- Snooze: ACTION_SNOOZE constant, shows toast "Reminder snoozed for 10 minutes"
- Dismiss: ACTION_DISMISS constant, stops service without reschedule
- Content tap (setContentIntent): Same as dismiss

**11. Key Code Paths Section**
Create a table mapping user actions to entry points:
| User Action | Entry Point | Flow |
| Reminder saved | ReminderWorkerUtils.enqueueReminderWorker() | OneTimeWorkRequest -> ReminderTriggerWorker |
| Alarm time reached | AlarmManager fires PendingIntent | -> NotificationStarterService.onStartCommand() |
| User taps Snooze | NotificationStopperService (ACTION_SNOOZE) | Stop service + reschedule |
| User taps Dismiss | NotificationStopperService (ACTION_DISMISS) | Stop service only |
| Device reboots | BootReceiver.onReceive() | PeriodicWorkRequest -> ReminderTriggerWorker |

**12. Debugging Guide Section**
Provide troubleshooting steps for common issues:
- Notification not showing: Check POST_NOTIFICATIONS permission, check notification channel settings
- Alarm not firing: Check SCHEDULE_EXACT_ALARM permission, check battery optimization
- Sound not playing: Check foregroundServiceType, check alarm.raw resource exists
- Vibration not working: Check VIBRATE permission

**13. Next Steps Links**
Link to RECURRENCE.md for recurrence logic details (matching pattern from REMINDERS.md)

After creating NOTIFICATIONS.md, update docs/README.md:
- Change "features/NOTIFICATIONS.md | Planned" to "features/NOTIFICATIONS.md | Available"
- Update documentation timestamp at bottom
  </action>
  <verify>
1. File exists: ls docs/features/NOTIFICATIONS.md
2. Line count: wc -l docs/features/NOTIFICATIONS.md (expect >= 400 lines)
3. Contains key terms: grep -c "ReminderTriggerWorker\|NotificationStarterService\|POST_NOTIFICATIONS\|SCHEDULE_EXACT_ALARM" docs/features/NOTIFICATIONS.md (expect >= 4)
4. Mermaid diagrams: grep -c "sequenceDiagram" docs/features/NOTIFICATIONS.md (expect >= 3)
5. README updated: grep "NOTIFICATIONS.md.*Available" docs/README.md
  </verify>
  <done>
- docs/features/NOTIFICATIONS.md exists with >= 400 lines
- Contains 3+ sequence diagrams for notification flow, snooze/dismiss, and boot handling
- All 6 permissions are documented with explanations
- Notification channel configuration is documented
- Key code paths table maps user actions to entry points
- Debugging guide covers common issues
- docs/README.md shows NOTIFICATIONS.md as "Available"
  </done>
</task>

</tasks>

<verification>
1. Documentation completeness:
   - grep "POST_NOTIFICATIONS" docs/features/NOTIFICATIONS.md
   - grep "SCHEDULE_EXACT_ALARM" docs/features/NOTIFICATIONS.md
   - grep "ReminderTriggerWorker" docs/features/NOTIFICATIONS.md
   - grep "NotificationStarterService" docs/features/NOTIFICATIONS.md
   - grep "BootReceiver" docs/features/NOTIFICATIONS.md

2. Diagram presence:
   - grep -c "```mermaid" docs/features/NOTIFICATIONS.md (expect >= 3)

3. README status:
   - grep "NOTIFICATIONS.md.*Available" docs/README.md

4. Navigation links work:
   - grep "REMINDERS.md" docs/features/NOTIFICATIONS.md
   - grep "ARCHITECTURE.md" docs/features/NOTIFICATIONS.md
</verification>

<success_criteria>
1. docs/features/NOTIFICATIONS.md exists with comprehensive notification documentation
2. ReminderTriggerWorker workflow is documented with sequence diagram
3. All 6 permissions are explained with their purposes
4. Notification channel configuration is documented
5. Snooze and dismiss flows are documented with sequence diagram
6. Boot handling is documented with sequence diagram
7. Debugging guide helps developers troubleshoot common issues
8. Developer can trace notification flow from trigger to display after reading
</success_criteria>

<output>
After completion, create `.planning/phases/07-notifications-feature/07-01-SUMMARY.md`
</output>
