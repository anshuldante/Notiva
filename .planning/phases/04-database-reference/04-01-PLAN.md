---
phase: 04-database-reference
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/DATABASE.md
  - docs/README.md
autonomous: true

must_haves:
  truths:
    - "Developer can find ReminderModel entity fields with types and purposes"
    - "Developer can find DAO methods with query explanations"
    - "Developer can view ER diagram showing entity relationships"
    - "Developer can understand TypeConverters and how Calendar/RecurrenceType are stored"
    - "Developer can write a new Room query after reading the examples"
  artifacts:
    - path: "docs/DATABASE.md"
      provides: "Complete database reference documentation"
      min_lines: 150
      contains:
        - "ReminderModel"
        - "ReminderDao"
        - "TypeConverters"
        - "mermaid"
    - path: "docs/README.md"
      provides: "Updated documentation status"
      contains: "Available"
  key_links:
    - from: "docs/DATABASE.md"
      to: "docs/ARCHITECTURE.md"
      via: "Cross-reference link"
      pattern: "\\[Architecture\\].*ARCHITECTURE\\.md"
    - from: "docs/README.md"
      to: "docs/DATABASE.md"
      via: "Navigation table"
      pattern: "DATABASE\\.md.*Available"
---

<objective>
Create comprehensive database reference documentation for the Notiva Android app.

Purpose: Enable developers to understand the Room database schema, write new queries, and work confidently with the data layer. This is a critical reference document for any developer modifying the data model.

Output: docs/DATABASE.md with schema documentation, ER diagram, TypeConverter explanations, DAO method documentation, and practical query examples.
</objective>

<execution_context>
@/Users/ansagagr/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ansagagr/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/STACK.md
@.planning/codebase/ARCHITECTURE.md
@docs/README.md
@docs/ARCHITECTURE.md

Source files to reference:
@app/src/main/java/com/ava/notiva/model/ReminderModel.java
@app/src/main/java/com/ava/notiva/model/RecurrenceType.java
@app/src/main/java/com/ava/notiva/data/ReminderDao.java
@app/src/main/java/com/ava/notiva/data/RemindersDb.java
@app/src/main/java/com/ava/notiva/converter/DbTypeConverters.java
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DATABASE.md with complete schema documentation</name>
  <files>docs/DATABASE.md</files>
  <action>
Create docs/DATABASE.md with the following structure:

1. **Header and Introduction**
   - Title: "Database Reference"
   - Brief introduction explaining this documents the Room database layer
   - Link back to Architecture Overview for context

2. **Tech Stack Summary Table**
   - Room version: 2.8.1
   - Database name: reminders_db (from DbModule)
   - Schema version: 1
   - Export schema: false

3. **Mermaid ER Diagram**
   - Show the `reminders` table with all columns
   - Include column types (INTEGER, TEXT, etc.)
   - Mark PK for primary key
   - Since there's only one entity, keep it simple but complete
   - Format:
   ```mermaid
   erDiagram
       REMINDERS {
           INTEGER id PK "Auto-generated primary key"
           INTEGER active "Boolean: 0=inactive, 1=active"
           TEXT name "Reminder display name"
           INTEGER start_date "Calendar as epoch milliseconds"
           INTEGER recurrence_delay "Multiplier for recurrence interval"
           TEXT recurrence_type "Enum: YEAR, MONTH, DAY, HOUR, MINUTE, FOREVER, NEVER"
           INTEGER end_date "Calendar as epoch milliseconds (null for FOREVER)"
       }
   ```

4. **Entity Documentation: ReminderModel**
   - File location: `app/src/main/java/com/ava/notiva/model/ReminderModel.java`
   - Table name: `reminders`
   - Annotations used: `@Entity`, `@PrimaryKey`, `@ColumnInfo`, `@TypeConverters`, `@Ignore`

   - **Fields Table** with columns:
     | Field | Column Name | Type (Java) | Type (SQLite) | Nullable | Default | Purpose |
     Include all 7 fields:
     - id (int -> INTEGER, PK, auto-generated)
     - active (boolean -> INTEGER, default true)
     - name (String -> TEXT)
     - startDateTime (Calendar -> INTEGER via TypeConverter, column: start_date)
     - recurrenceDelay (int -> INTEGER, column: recurrence_delay)
     - recurrenceType (RecurrenceType -> TEXT, column: recurrence_type)
     - endDateTime (Calendar -> INTEGER via TypeConverter, column: end_date)

   - **Business Logic Section**
     Document `getNextOccurrenceAfter(Calendar now)` method:
     - Purpose: Calculate the next occurrence time for recurring reminders
     - Logic explanation: Handles NEVER (one-time), FOREVER (infinite), and bounded recurrence
     - Returns null if reminder has expired or is past end date

5. **RecurrenceType Enum Documentation**
   - File location: `app/src/main/java/com/ava/notiva/model/RecurrenceType.java`
   - Table of all enum values with display value and milliseconds:
     | Enum | Display Value | Milliseconds | Notes |
     - YEAR: "Year(s)", 31,622,400,000 (366 days)
     - MONTH: "Month(s)", 2,678,400,000 (31 days)
     - DAY: "Day(s)", 86,400,000
     - HOUR: "Hour(s)", 3,600,000
     - MINUTE: "Minute(s)", 60,000
     - FOREVER: "Forever", 0 (no end date)
     - NEVER: "Never", 0 (one-time reminder)

   - Explain how recurrenceDelay multiplies the base interval

6. **TypeConverters Documentation**
   - File location: `app/src/main/java/com/ava/notiva/converter/DbTypeConverters.java`
   - Explain the Calendar <-> Long conversion
   - Show code snippets:
     - `toCalendar(Long)`: Converts epoch millis to Calendar
     - `fromCalendar(Calendar)`: Converts Calendar to epoch millis
   - Note: RecurrenceType uses Room's built-in enum-to-string conversion (no custom converter needed)

7. **Database Definition: RemindersDb**
   - File location: `app/src/main/java/com/ava/notiva/data/RemindersDb.java`
   - Annotations: `@Database`
   - Configuration:
     - entities: ReminderModel.class
     - version: 1
     - exportSchema: false
   - Abstract method: `reminderDao()` returns ReminderDao

8. **DAO Documentation: ReminderDao**
   - File location: `app/src/main/java/com/ava/notiva/data/ReminderDao.java`
   - For each method, document:
     | Method | Annotation | Query/Operation | Return Type | Use Case |

     Methods to document:
     - `add(ReminderModel)` - @Insert, returns long (generated ID)
     - `deleteAll()` - @Query("DELETE FROM reminders"), void
     - `delete(ReminderModel)` - @Delete, void
     - `updateStatus(int id, boolean isActive)` - @Query, void, partial update
     - `update(ReminderModel)` - @Update, void
     - `getAll()` - @Query, LiveData<List<ReminderModel>>, reactive
     - `getAllSync()` - @Query, List<ReminderModel>, synchronous for Workers
     - `get(int id)` - @Query, LiveData<ReminderModel>, single item reactive

9. **Query Examples Section**
   - Show how to write new queries following existing patterns
   - Example 1: Get active reminders only
     ```java
     @Query("SELECT * FROM reminders WHERE active = 1 ORDER BY start_date ASC")
     LiveData<List<ReminderModel>> getActiveReminders();
     ```
   - Example 2: Get reminders by recurrence type
     ```java
     @Query("SELECT * FROM reminders WHERE recurrence_type = :type")
     List<ReminderModel> getByRecurrenceType(String type);
     ```
   - Example 3: Count reminders
     ```java
     @Query("SELECT COUNT(*) FROM reminders")
     int getCount();
     ```
   - Explain the parameter binding syntax (`:paramName`)

10. **Best Practices Section**
    - Use LiveData for UI-bound queries (automatic lifecycle handling)
    - Use sync methods only in Workers/background threads
    - Always run database operations off the main thread
    - Use Repository pattern to abstract DAO access
    - Reference the threading model in ARCHITECTURE.md

11. **Footer**
    - "Next Steps" section linking to:
      - Reminders Feature (how reminders are created/edited)
      - Architecture Overview (data flow context)
      - README (documentation navigation)
    - Last updated date

Style notes:
- Use consistent formatting with existing docs (ARCHITECTURE.md, SETUP.md)
- Include code snippets showing actual Java code
- Keep explanations practical and developer-focused
- Use tables for structured information
  </action>
  <verify>
    - File exists: `ls docs/DATABASE.md`
    - Contains Mermaid ER diagram: `grep -c "erDiagram" docs/DATABASE.md` returns 1
    - Documents all ReminderModel fields: `grep -c "startDateTime\|endDateTime\|recurrenceType\|recurrenceDelay\|active\|name" docs/DATABASE.md` returns > 6
    - Documents all DAO methods: `grep -c "@Insert\|@Delete\|@Update\|@Query" docs/DATABASE.md` returns > 4
    - Contains TypeConverter section: `grep -c "TypeConverter" docs/DATABASE.md` returns > 1
    - Contains query examples: `grep -c "SELECT \* FROM reminders" docs/DATABASE.md` returns > 2
  </verify>
  <done>
    - docs/DATABASE.md exists with 150+ lines
    - Mermaid ER diagram renders showing reminders table schema
    - All 7 ReminderModel fields documented with types and purposes
    - All 8 DAO methods documented with query explanations
    - TypeConverters explained with code snippets
    - RecurrenceType enum values and milliseconds documented
    - Query examples show how to write new Room queries
    - Best practices section guides proper database usage
  </done>
</task>

<task type="auto">
  <name>Task 2: Update README.md documentation status</name>
  <files>docs/README.md</files>
  <action>
Update docs/README.md to reflect that DATABASE.md is now available:

1. In the "Documentation Status" table, change the DATABASE.md row:
   - FROM: `| [DATABASE.md](DATABASE.md) | Planned | Room schema and migrations |`
   - TO: `| [DATABASE.md](DATABASE.md) | Available | Room schema and migrations |`

No other changes needed - the navigation table already links to DATABASE.md correctly.
  </action>
  <verify>
    - `grep "DATABASE.md.*Available" docs/README.md` returns a match
  </verify>
  <done>
    - docs/README.md shows DATABASE.md status as "Available"
    - Navigation table still correctly links to DATABASE.md
  </done>
</task>

</tasks>

<verification>
After completing all tasks:

1. **Documentation exists and is complete:**
   ```bash
   ls -la docs/DATABASE.md
   wc -l docs/DATABASE.md  # Should be 150+ lines
   ```

2. **ER diagram is present:**
   ```bash
   grep -A 15 "erDiagram" docs/DATABASE.md
   ```

3. **All schema elements documented:**
   ```bash
   grep -E "ReminderModel|ReminderDao|RemindersDb|TypeConverter|RecurrenceType" docs/DATABASE.md | wc -l
   # Should return 10+
   ```

4. **README updated:**
   ```bash
   grep "DATABASE.md" docs/README.md
   # Should show "Available" status
   ```

5. **Cross-references work:**
   ```bash
   grep -E "ARCHITECTURE.md|README.md" docs/DATABASE.md
   # Should find links to related docs
   ```
</verification>

<success_criteria>
Phase 4 is complete when:

1. docs/DATABASE.md exists with comprehensive schema documentation
2. Mermaid ER diagram shows the reminders table with all columns
3. ReminderModel entity has all 7 fields documented with types and purposes
4. All 8 ReminderDao methods are documented with query explanations
5. TypeConverters (Calendar <-> Long) are explained with code
6. RecurrenceType enum values documented with millisecond values
7. Query examples demonstrate how to write new Room queries
8. Best practices guide developers on proper database usage
9. docs/README.md shows DATABASE.md as "Available"
10. A developer reading the documentation can confidently write new Room queries
</success_criteria>

<output>
After completion, create `.planning/phases/04-database-reference/04-01-SUMMARY.md` using the summary template.
</output>
